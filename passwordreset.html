<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Work+Sans:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <style>
        body {
            font-family: 'Work Sans', sans-serif;
        }
    </style>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"
        integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
    <script src="./static/js/theme.js"> </script>
    <script src="./static/js/confic.js"></script>
</head>

<body class="flex items-center justify-center min-h-screen bg-gray-100">
    <div class="w-full max-w-md p-8 bg-white rounded-lg shadow-md">
        <h2 class="mb-6 text-2xl font-semibold text-center">Password Reset</h2>

        <form id="login">
            <div class="mb-3">
                <label for="email" class="block text-sm font-medium text-gray-700">New Password</label>
                <input type="password" id="password" placeholder="password" required
                    pattern="(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{8,}" 
                    title="Must contain at least one number and one uppercase and lowercase letter, and at least 8 or more characters" 
                    class="w-full px-3 py-2 mt-1 border rounded-md focus:ring-2 focus:ring-pink-400 focus:outline-none">
            </div>
            <div class="mb-3 flex items-center px-1 text-xs">
                <input type="checkbox" id="showpass" onchange="showPassword(this.checked)"
                    class="w-4 h-4 text-pink-500 border-gray-300 rounded focus:ring-pink-400">
                <label for="showpass" class="ml-2 text-gray-700">Show password</label>
            </div>

            <div class="mb-4 relative">
                <label for="password" class="block text-sm font-medium text-gray-700">Conform Password</label>
                <input type="password" id="conformPassword" placeholder="•••••••••••" required
                    class="w-full px-3 py-2 mt-1 border rounded-md focus:ring-2 focus:ring-pink-400 focus:outline-none">
                <!-- <a href="#" class="absolute right-3 top-9 text-sm text-pink-500 hover:underline">Forgot Password?</a> -->
            </div>

            <div class="mb-4">
                <p id="error" class="text-xs text-red-600"></p>
            </div>

            <button type="submit"
                class="w-1/2 py-2 text-white bg-gradient-to-r from-primary from-5% to-blue-800 rounded-md hover:bg-pink-600">
                Save
            </button>
        </form>
    </div>
    <script>
        let queryString = window.location.search;
        let urlParam = new URLSearchParams(queryString)
        let token = urlParam.get("token")
        if (!token) {
            $("body").prepend(`<div class="text-red-500 font-medium text-xl"> Invalid URL </div>`)
            setTimeout(() => { window.location.href = "login.html" }, 800)
        }
        $(async function (params) {

            var password
            $('#password').on('change', function (e) {
                password = e.target.value
            })
            var conformpassword
            $('#conformPassword').on('keyup', function (e) {
                conformpassword = e.target.value
                if (password == conformpassword) {
                    $(this).removeClass("focus:ring-red-600")
                } else
                    $(this).addClass("focus:ring-red-600")
            })

            $('form#login').off('submit')
            $('form#login').on('submit', function (e) {
                e.preventDefault()
                if (password == conformpassword){
                    try {
                        ProgressLoading(true)
                        fetch(`${DomainURL}/password/reset?token=${token}`, {
                            method: "POST",
                            body: JSON.stringify({
                                password: password
                            })
                        })
                            .then(res => res.ok ? res.json() : showAlertMessage("warning", "API error", `${res.status} ${res.statusText}`))
                            .then(data => {
                                if (data?.status === 1) {
                                    // $('#error').text(data?.message)
                                    // $.cookie("access_token", data.access_token,)
                                    // $.cookie("user_name", data.user.user_name)
                                    // if (data.user_profile)
                                    //     window.location.href = 'index.html'
                                    // else
                                    showAlertMessage("success", "Password Reset","Your password reset successfully.")
                                        setTimeout(()=>window.location.href = "login.html",1000)
                                    // console.log(data)
                                }
                                else {
                                    showAlertMessage("error", "Password Reset",data?.message)
                                }
                                // console.log(data)
                                ProgressLoading(false)
                            });
                    } catch (error) {
                        ProgressLoading(false)
                        showAlertMessage("warning", "API error", error)
                    }
                }else{
                    showAlertMessage("warning", "Password", "Password not matched.")
                }

            })
        })

        function showPassword(checked){
            if(checked)
                $("form #password").prop("type","text")
            else
                $("form #password").prop("type","password")
        }
    </script>
</body>

</html>