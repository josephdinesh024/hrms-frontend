<!-- Bank Section -->
<div id="tab-bank" class="tab-section">
    <h2 class="text-lg font-semibold mb-4">Bank Details</h2>
    <form id="bank-form" class="space-y-4">
    </form>
</div>

<div class="absolute bottom-6 right-12">
    <button
        onclick="OpenConfirmForm()"
        class="py-2 px-8 shadow-sm shadow-third rounded-lg font-semibold text-third 
                                hover:bg-gradient-to-r from-primary from-5% to-blue-800 hover:text-white transition-all duration-500">
        Submit
    </button>
</div>

<script>
    $(function () {
        $("#tab-bank form#bank-form").html(`
        <div id="bank-container" class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <input type="hidden" id="bank_id" name="id" value="0" />
            ${floatingInputTag("text","holder_name","holder_name","Account Holder Name")}
            ${floatingInputTag("text","account_number","account_number","Account Number")}
            ${floatingInputTag("text","bank_name","bank_name","Bank Name")}
            ${floatingInputTag("text","ifsc_code","ifsc_code","IFSC Code")}
        </div>
        <div class="flex space-x-2 justify-end">
            <input type="submit" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600 cursor-pointer" value="Save"/>
        </div>
        `)
        let UserBank = []
        function initFun() {
            try {
                fetch(`${DomainURL}/my/bank`, {
                    headers: {
                        "Content-Type": "application/json",
                        Authorization: `Bearer ${access_token}`
                    },
                    method: "GET"
                })
                    .then(res => res.json())
                    .then(data => {
                        if (data.status) {
                            // console.log(data)
                            UserBank = data.bank
                            if (UserBank.length) {
                                $("#bank-form #bank-container").empty()
                                UserBank.forEach((item, index) => {
                                    $("#bank-form #bank-container").append(`
                                    <input type="hidden" id="bank_id" name="id" value="${item.id}" />
                                    ${floatingInputTag("text","holder_name","holder_name","Account Holder Name",value=item.holder_name)}
                                    ${floatingInputTag("text","account_number","account_number","Account Number",value=item.account_number)}
                                    ${floatingInputTag("text","bank_name","bank_name","Bank Name",value=item.bank_name)}
                                    ${floatingInputTag("text","ifsc_code","ifsc_code","IFSC Code",value=item.ifsc_code)}
                                `);
                                });
                            }

                        } else {
                            console.log(data.message)
                        }
                    })
            } catch (error) {
                showAlertMessage("warning","API error", error)
            }
        }
        initFun()

        $(document).off("submit", "#tab-bank form#bank-form");

        $(document).on("submit", "#tab-bank form#bank-form", function (e) {
            e.preventDefault();
            let formData = new FormData(this);
            let item = {}
            formData.forEach((val, key) => { item[key] = val });

            try {
                fetch(`${DomainURL}/my/bank${item.id != "0" ? "/" + item.id : ""}`, {
                    headers: {
                        "Content-Type": "application/json",
                        Authorization: `Bearer ${access_token}`
                    },
                    method: item.id != 0 ? "PUT" : "POST",
                    body: JSON.stringify({
                        "holder_name": item.holder_name,
                        "account_number": item.account_number,
                        "bank_name": item.bank_name,
                        "ifsc_code": item.ifsc_code
                    })
                })
                    .then(res => res.json())
                    .then(data => {
                        if (data.status) {
                            $(`#bank-form #bank-container #bank_id`).val(data.bank.id)
                            // console.log(data)
                            showAlertMessage("success","Employee profile","Bank details saved")
                        } else {
                            showAlertMessage("error","Employee profile",data.message)
                        }
                    })
            } catch (error) {
                showAlertMessage("warning","API error", error)
            }
        })
    });
</script>