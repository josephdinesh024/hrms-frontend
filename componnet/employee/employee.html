<div id="employeeList" class="employee-container w-full h-[90%] bg-white shadow-md rounded-lg overflow-hidden flex">
    <div id="filterAction" class="max-w-1/4 min-w-fit min-h-full bg-gray-50 p-6 border-r flex flex-col justify-end">
        <div class="flex gap-2 items-center text-md px-2">
            <button id="previous"><i class="fa-solid fa-circle-chevron-left"></i></button>
            <span id="countMessage">5 of 10</span>
            <button id="next"><i class="fa-solid fa-circle-chevron-right"></i></button>
        </div>
    </div>
    <hr>
    <div id="employeeCardList" class="w-full">
        <table class="w-full border-collapse text-xs">
            <thead>
                <tr class="bg-gray-100 text-gray-700 text-left">
                    <th class="p-4 border-b">Employee ID</th>
                    <th class="p-4 border-b">Full Name</th>
                    <th class="p-4 border-b">Role</th>
                    <th class="p-4 border-b">Email</th>
                    <th class="p-4 border-b">Phone number</th>
                    <th class="p-4 border-b">Status</th>
                </tr>
            </thead>
            <tbody>

            </tbody>
        </table>
    </div>
</div>

<div id="selectedEmployee" class="flex-1 w-full justify-items-center employee-container">

</div>


<script>
    $(function () {

        let employee = []
        let page = urlParams.get("page") || 1
        let paseSize = PAGESIZE
        let TotalCount = 0
        let selectedID = urlParams.get("employee_id")

        function initFetch() {
            $("#editPanel #editContent").empty()
            closePanel()
            try {
                ProgressLoading(true)
                fetch(`${DomainURL}/user?page_size=${paseSize}&page=${page}`, {
                    headers: {
                        "Content-Type": "application/json",
                        Authorization: `Bearer ${access_token}`
                    },
                    method: "GET"
                })
                    .then(res => res.ok ? res.json() : showAlertMessage("warning", "API error", `${res.status} ${res.statusText}`))
                    .then(data => {
                        // console.log(data)
                        if (data.status) {
                            $("#employeeCardList tbody").empty()
                            employee = data.user
                            TotalCount = data.total_count
                            if (employee.length)
                                employee.forEach((element, index) => {
                                    $("#employeeCardList tbody").append(`
                                <tr id="${index}" class="border-b hover:bg-gray-50 transition cursor-pointer selectedList">
                                    <td class="p-4">${capitalizeFirstLetter(element.user_name)}</td>
                                    <td class="p-4">${capitalizeFirstLetter(element.profile.first_name + " " + element.profile.last_name || "--")}</td>
                                    <td class="p-4">${roleName(element.access)}</td>
                                    <td class="p-4">${element.email}</td>
                                    <td class="p-4">${element.profile.phone || "--"}</td>
                                    <td class="p-4">
                                        ${StatusColourCode(element.status)}
                                    </td>
                                </tr>
                            `)

                                });
                            var total = (page - 1) * paseSize
                            $("#countMessage").text(`${total + employee.length} of ${TotalCount}`)
                        }
                        ProgressLoading(false)
                    });

            } catch (error) {
                ProgressLoading(false)
                showAlertMessage("warning", "API error", error)
            }
        }
        $(".employee-container").hide()
        if (selectedID) {
            $("#selectedEmployee").load("./componnet/employee/emp-details.html")
            $("#selectedEmployee").show()
        } else {
            $("#employeeList").show()
            initFetch()
        }
        // Role name extract
        function roleName(access) {
            for (let item of access) {
                if (item["module_type"] === "role" && item["status"] === 1) {
                    var name = item["module"]["name"]
                    return capitalizeFirstLetter(name)
                }
            }
            return "--"
        }

        $(document).on("click", "button#previous", function () {
            if (page != 1) {
                page -= 1
                initFetch()
            }
        })

        $(document).on("click", "button#next", function () {
            let check = TotalCount - (paseSize * page)
            if (check > 0) {
                page += 1
                initFetch()
            }
        })

        $(document).on("click", "#employeeCardList tbody tr.selectedList", function () {
            // SelectedEmployee(employee[$(this).attr("id")].id)
            let ID = employee[$(this).attr("id")].id
            window.location.href = `?employee_id=${ID}&page=${page}`
        });

    })

    function calenderInit() {
        let currentMonth = new Date().getMonth();
        let currentYear = new Date().getFullYear();

        const attendanceData = {
            '2025-06-01': 'worked',
            '2025-06-02': 'half',
            '2025-06-03': 'leave',
            '2025-06-06': 'worked',
            '2025-06-07': 'half',
            // Add more
        };

        function renderCalendar() {
            const calendar = document.getElementById("calendar-grid");
            calendar.innerHTML = "";

            const label = document.getElementById("monthYearLabel");
            const monthName = new Date(currentYear, currentMonth).toLocaleString("default", { month: "long" });
            label.textContent = `Attendance - ${monthName} ${currentYear}`;

            const firstDay = new Date(currentYear, currentMonth, 1).getDay();
            const totalDays = new Date(currentYear, currentMonth + 1, 0).getDate();

            for (let i = 0; i < firstDay; i++) {
                calendar.innerHTML += `<div></div>`;
            }

            for (let day = 1; day <= totalDays; day++) {
                const dateStr = `${currentYear}-${String(currentMonth + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                const status = attendanceData[dateStr] || 'none';

                let bgColor = 'bg-gray-200', label = 'No Entry';
                if (status === 'worked') bgColor = 'bg-green-400', label = 'Worked Full Day';
                else if (status === 'half') bgColor = 'bg-yellow-400', label = 'Half Day / Permission';
                else if (status === 'leave') bgColor = 'bg-red-400', label = 'Leave';

                calendar.innerHTML += `
        <div onclick="showModal('${dateStr}', '${label}')" 
             class="h-10 flex items-center justify-center ${bgColor} rounded cursor-pointer text-white font-medium hover:opacity-90">
          ${day}
        </div>`;
            }
        }

        function changeMonth(direction) {
            currentMonth += direction;
            if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
            }
            if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
            }
            renderCalendar();
        }

        function showModal(date, status) {
            document.getElementById('modalDate').textContent = `Date: ${date}`;
            document.getElementById('modalStatus').textContent = `Status: ${status}`;
            document.getElementById('attendanceModal').classList.remove('hidden');
            document.getElementById('attendanceModal').classList.add('flex');
        }

        function closeModal() {
            document.getElementById('attendanceModal').classList.remove('flex');
            document.getElementById('attendanceModal').classList.add('hidden');
        }

        renderCalendar();
    }

</script>

<script>
    $(function () {
        // floatingInputTag(type,id,name,labelName,value="",required=true,disabled)
        $(document).ready(function () {
            $("#edit-modal #edit-form").html(`
                ${floatingInputTag("text", "first_name", "first_name", "First Name")}
                ${floatingInputTag("text", "last_name", "last_name", "Last Name")}
                ${floatingInputTag("text", "email", "email", "Email", "", false, true)}
                ${floatingInputTag("number", "phone", "phone", "Phone")}
                ${floatingInputTag("text", "dob", "dob", "Date of Birth")}
                <div class="w-64 mt-4">
                    <label class="w-full text-sm text-blue-500">Gender</label>
                    <select id="gender" name="gender" class="w-full border-b-2 border-gray-300 bg-transparent text-sm pb-1 focus:outline-none focus:border-blue-500">
                        <option>--</option>
                        <option selected value="male">Male</option>
                        <option value="female">Female</option>
                    </select>
                </div>
                ${floatingInputTag("text", "address", "address", "Address")}
                ${floatingInputTag("text", "city", "city", "City")}
                ${floatingInputTag("text", "state", "state", "State")}
                ${floatingInputTag("text", "country", "country", "Country")}
                ${floatingInputTag("text", "pincode", "pincode", "Pincode")}
            `)
        })
    })
</script>

<style>
    /* .input {
        width: 100%;
        padding: 8px;
        border: 1px solid #ccc;
        border-radius: 4px;
    } */

    .tab-button {
        padding: 10px 20px;
        border-bottom: 2px solid transparent;
        color: #6b7280;
        cursor: pointer;
    }

    .tab-button:hover {
        color: #374151;
        border-color: #d1d5db;
    }

    .tab-button.active {
        color: #2563eb;
        border-color: #3b82f6;
    }

    .hidden {
        display: none;
    }
</style>